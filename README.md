# WMJ战队 2021赛季视觉代码

西北工业大学纵维立方WMJ战队2021赛季视觉完整功能代码

## 仓库说明

### 仓库目录

```
.
├── libBase                     // 基础单元库，包含时间、键盘事件、彩色字符相关等常用函数和PI、GimbalPose等常用定义
├── libControl                  // 控制单元库，包含各种控制解算器
│   ├── PID                 	// PID速度环解算器类
│   ├── Pose                 	// 云台位姿解算器类
│   ├── Predict                 // 卡尔曼线性预测器类
│   └── TopAimer                // 反陀螺预测器类
├── libFSM                  	// 有限状态机库，包含状态机主循环线程和各线程核心代码，如装甲板自瞄、大符、自动曝光等
├── libHardware                 // 硬件单元库，包含与硬件和电控相关的代码库
│   ├── Control               	// 机器人控制类，包括云台位姿控制、发射控制、按键信息等
│   ├── Transport               // 机器人通讯类
│	│	├── include				// 包含通讯基类的头文件和通讯协议
│	│	├── CanPort				// can通讯类
│	│	└── SerailPort			// 串口通讯类
│   └── UsbCapture              // 大恒相机驱动
├── libVision                  	// 识别单元库，包含与识别相关的类
│   ├── Armor                 	// 装甲板识别类
│   ├── Bino                 	// 双目测距类
│   └── Rune                	// 大符识别与解算类
├── shell              			// 用于存放调试常用脚本，包括watchdog
├── video              			// 用于存放录制视频
├── wmj_cfg	              		// 曾用于存放所有参数文件，现仅存放标定参数文件
├── CMakeLists.txt              // CMake工程文件
├── Main.cpp                    // 主函数
├── README.md                   // 项目说明文件
└── setup                       // 初始化仓库脚本
```

### 运行环境

| 操作系统     | 依赖库                         | 硬件                                                 | Tool                   |
| ------------ | ------------------------------ | ---------------------------------------------------- | ---------------------- |
| Ubuntu 18.04 | OpenCV 3.4.x<br />大恒相机驱动 | IntelNUC<br />大恒工业相机<br />USB转can，或USB转TTL | g++/clang++<br />CMake |

### 运行方式

#### 调试

首次克隆仓库需运行`git submodule update --recursive --init`初始化子仓库

```shell
mkdir build
cd build
cmake ..
make -j
```

*或者直接运行setup脚本*

编译完成后根据需要执行测试程序或主程序。

#### 比赛

在开机脚本/etc/rc.local中加入如下行

```shell
cd /home/wmj/WMJ2021/build
./watchdog
```

### 代码原理

*详见各模块说明*

## 代码规范

提交前务必注意是否符合此规范. 按照能够开源的标准来写代码, 清晰的逻辑不仅方便他人使用你的代码, 在你修改时也能提高效率

### 命名

#### 代码

* 函数名：使用首字母小写的驼峰命名法

* 类名：使用首字母大写的驼峰命名法

* 变量名：使用下划线分割命名法，类成员以m_开头，必须做到看到名称就能知道这是什么，长一点没有关系

#### 文件

首字母大写的驼峰命名法

### 注释

* 关键函数必须写上注释说明用途

* 注释写在函数之前

* 对于namspace、#else、#if给出行末注释

* 有必要的变量

### 目录结构

* 每个模块的测试文件和参数文件放在本文件夹下, 避免一次提交更新多个仓库

* 单个文件不要过长, 可以把一些函数分离出来到新文件

### 编译

* 头文件前加上#pragma once

### Git

***如果不确定怎么操作先问管理员, 不要出现垃圾操作, 主模块不要直接提交到master***

* 自己的模块直接在master操作, 或是及时merge, 保证别人用到的是最新的; 需要操作别人的分支时直接沟通让对方修改, 或是修改后merge, 切不可擅自修改他人模块

### 模块化

* 尽可能减少与其他模块的依赖, 如果依赖过多考虑合并成一个模块或者从那个模块拆分出一部分

* 提前协商好接口

## 注意事项
- clone下来后请执行"git submodule update --recursive --init"来获取所有代码，或者以后直接在clone时加--recursive 🍵🍵🍵🍵
- 平常千万不要对master分支有任何操作，请clone下来后创建自己的分支进行开发 ⚡⚡⚡⚡
- 务必创建.gitignore文件，不要把编译文件或编译出的可执行文件传到仓库，也不要上传视频🔥🔥🔥🔥
- 当master主分支有稳定更新时，请注意pull一下！与时俱进🚊🚕
- 新增了matplotlib头文件，要使用的话先在pc上安装python3-pip(apt) 再pip3 install matplotlib
